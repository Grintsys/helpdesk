{% extends "templates/web.html" %}

{% block page_content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
{{ frappe.render_template('templates/components/breadcrumbs/breadcrumbs.html', {})}}
<div>
    <div class="mb-20">
        <h2 class="">Knowledge Base</h2>
        <div class="w-50">
            <input id="propSearchBar" class="form-control" type="text" placeholder="Search the docs"  maxlength="0">
        </div>
    </div>
</div>
{% if is_group %}
<div class="d-flex flex-wrap">
    {% set sub_categories = frappe.get_all("Category", filters={"parent_category": ['=', name]}, fields=['name', 'route']) %}
    {% set max_articles = 6 %}
    {% for sub_category in sub_categories %}
    <div class="col-sm-6 col-12 my-4 p-0">
        {% set articles = frappe.get_all("Article", filters={"category": ['=', sub_category.name]}, fields=['title', 'route']) %}
        <h3 role="button" onclick="window.location='/{{ sub_category.route }}'">{{ sub_category.name }}</h3>
        {% for article in articles %}
        {% if loop.index < max_articles %}
        <div class="article-list">
            <span style="color: #2490EF;" role="button" onclick="window.location='/{{ article.route }}'">{{ article.title }}</span>
        </div>
        {% elif loop.index == max_articles %}
        <a href='/{{ sub_category.route }}'>See all {{ articles|length }} articles</a>
        {% endif %}
        {% endfor %}
    </div>
    {% endfor %}
</div>
{% else %}
<div class="mb-5">
    {% set articles = frappe.get_all("Article", filters={"category": ['=', name]}, fields=['title', 'route', 'creation']) %}
    <h2>{{ name }} ({{ articles|length }})</h2>
    <table class="table table-borderless table-hover">
        <tbody>
            {% for article in articles %}
            <tr role="button" onclick="window.location='/{{ article.route }}'">
                <td>
                    <i class="bi bi-journals mr-2"></i>
                    <span>{{ article.title }}</span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<hr>
<div class="mt-20">
    <div class="my-1 d-flex justify-content-center">
        <p>{{ _("Still got questions? We're here to assist you.") }}</p>
    </div>
    <div class="d-flex justify-content-center">
        <button class="btn btn-primary">{{ _("Contact with us") }}</button>
    </div>
</div>

{{ frappe.render_template('templates/components/search/search.html', {}) }}

<script>
    frappe.ready(function() {
        $("#propSearchBar").click(function() {
            showSearchBar();
        })
    });
</script>

{% endblock %}


